var onlineBizPanel=function(e,n){function d(){a.toggleClass("ob-expanded ob-collapse"),t.toggleClass("ob-fadeOut ob-fadeIn"),o.find("i").toggleClass("rotate-up")}function c(e){e.outerHeight()}function u(e,n){var o=e?t:i;o.addClass("ob-hide"),o.toggleClass("ob-fadeOut ob-fadeIn"),n.removeClass("ob-hide"),c(n),n.toggleClass("ob-fadeOut ob-fadeIn"),e||p.set(a[0])}function f(e){d()}function b(n){u(!1,t),s.addClass("ob-hide"),e(".bottom-wrap, .top-wrap").remove()}function m(n){n.preventDefault();var a=e(this).attr("data-businessname"),t=ajaxManager.search("CompanyName",a),o=u.bind(null,!0,i);s.removeClass("ob-hide"),v(t,o)}function h(e){var n=e.target,a=n.scrollTop,i=n.scrollHeight-n.clientHeight;a>=6&&r&&(o.addClass("drop-shadow"),r=!1),5>=a&&(o.removeClass("drop-shadow"),r=!0),p.update(a),a===i&&t.hasClass("ob-fadeIn")&&ajaxManager.loadMore(10,k)}function g(e){p.save()}function C(e,a){var t=n.createElement(e);return a&&Object.keys(a).forEach(function(e){t.setAttribute(e,a[e])}),t}function v(a,t){var o,s="http://apps.brighthouse.stage/smallbizmonth/image.ashx",l=n.createDocumentFragment(),r=C("div",{"class":"top-wrap clearfix"}),p=C("div",{"class":"bottom-wrap"}),d=C("h2"),c=C("a",{"class":"ob-phone",href:"tel:"+a.Phone}),u=C("a",{href:a.WebSite,target:"_blank"}),f=C("p"),b=C("hr"),m=a.HasLogo?C("img",{src:s+"?logo=true&companyID="+a.CompanyID,alt:a.CompanyName,"class":"ob-details-logo"}):void 0,h=a.HasPhoto?C("img",{src:s+"?logo=false&companyID="+a.CompanyID,alt:a.CompanyName,"class":"ob-details-main-image"}):void 0;m?e(r).append(m):m,e(r).append(d),e(r).append(c),e(d).append(a.CompanyName),e(c).append(D(a.Phone)),e(l).append(r),e(p).append(f),e(p).append(u),h?e(p).append(b,h):h,e(f).append(a.BusinessDescription),e(u).append(a.WebSite),e(l).append(p),i.append(l),o=m?m:h,console.log("wait for image to load"),t()}function y(e,n){return e.length>n?e.slice(0,n-3)+"...":e}function D(e){var n=/[\D]/gi,a=/(\d{3})+(\d{3})+(\d{4})/gi,t=e.replace(n,""),o=t.replace(a,"$1-$2-$3");return o}function k(a){var o=n.createDocumentFragment();a.forEach(function(n){var a=C("li",{"class":"ob-fadeOut"}),t=C("a",{"class":"ob-details",href:"#","data-businessname":n.CompanyName}),i=C("p"),s=C("div",{"class":"ob-phone"}),l=n.WebSite?C("a",{href:n.WebSite,target:"_blank"}):void 0,r=C("h2"),p=y(n.BusinessDescription,73);e(a).append(t,s,l),e(r).append(n.CompanyName),e(i).append(p),e(t).append(r,i),e(s).append(D(n.Phone)),l?e(l).append(n.WebSite):l,e(o).append(a)}),t.append(o),c(t),t.children("li").removeAttr("class")}function x(){a.hasClass("ob-expanded")&&d()}function I(){a.hasClass("ob-collapse")&&d()}function w(n){a=e(n.listContainer),t=e(n.listInnerContainer),o=e(n.toggleElement),i=e(n.fullDetails),s=e(n.backButton),ajaxManager.loadData(k),o.bind("click",f),t.on("click",'a[class^="ob-details"]',m),a.on("scroll",h),s.bind("click",b),t.on("mousedown",g.bind(p))}var a,t,o,i,s,l,r=!0,p={top:[],temp:null,update:function(e){this.temp=e},save:function(){this.top.push(this.temp)},set:function(e){e.scrollTop=this.top[0],this.top.pop()}};return l={init:w,expand:I,collapse:x,buildList:k}}(jQuery,document);$(document).ready(function(){onlineBizPanel.init({listContainer:"#online-list-containter",listInnerContainer:"#online-list-containter ul",toggleElement:"#online-biz-toggle",fullDetails:"#ob-full-details",backButton:"#back-button"})});